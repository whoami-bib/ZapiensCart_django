{% extends 'base.html' %}
{% load static %}

{% block content %}


<section class="section-content padding-y bg " style="min-height: 50vh;">
    <div class="container">
    
    <!-- ============================ COMPONENT 1 ================================= -->
    {% if not cart_items %}

   
        <h2 class="text-info text-center">Your cart is emptyðŸ˜’</h2>
        <a href="{% url 'home' %}" class="btn btn-primary " style="margin-left: 40%; margin-top:100px ">Continue Shopping</a>
    
    


    {% else %}
    <div class="row">
        <aside class="col-lg-9">
    <div class="card">
    <table class="table table-borderless table-shopping-cart">
    <thead class="text-muted">
    <tr class="small text-uppercase">
      <th scope="col">Product</th>
      <th scope="col" width="120">Quantity</th>
      <th scope="col" width="120">Price</th>
      <th scope="col" class="text-right" width="200"> </th>
    </tr>
    </thead>
    <tbody>
    <tr>
        {% for cart_item in cart_items %}
        <td>
            <figure class="itemside align-items-center">
                <div class="aside"><img src="{{ cart_item.product.image.url }}" class="img-sm"></div>
                <figcaption class="info">
                    <a href="{{cart_item.product.get_url}}" class="title text-dark" >{{cart_item.product.product_name}}</a>
                        
                        <p  class="text-muted small">{% if cart_item.variations.all %}
                                {% for item in cart_item.variations.all %}
                                    {{ item.variation_category| capfirst }} : {{ item.variation_value | capfirst }} <br>
                                {% endfor %}
                            {% endif %}</p>
                </figcaption>
            </figure>
        </td>
        <td> 
            <!-- col.// -->
                        <div class="col"> 
                            <div class="input-group input-spinner">
                                {% comment %} <div class="input-group-prepend"><button type="button" class="form-control" id="increment{{cart_item.id}}" onclick="decreaseQuantity({{cart_item.id }},-1)"><i class="fa fa-minus"></i></button></div> {% endcomment %}
                                <div class="input-group-prepend">
                                <a href="{% url 'remove_cart' cart_item.product.id cart_item.id %}" class="btn btn-light" type="button" id="button-plus"> <i class="fa fa-minus"></i> </a>
                                </div> 
                                <input type="text" class="form-control"  value="{{cart_item.quantity}}"> 
                                {% comment %} <span class="form-control" id="{{cart_item.id}}">{{cart_item.quantity}}</span>{% endcomment %}
                                
                                <div class="input-group-append">
                                {% comment %} <div class="input-group-prepend"><button type="button" class="form-control" id="increment" onclick="decreaseQuantity({{cart_item.id }},1)"><i class="fa fa-plus"></i></button></div> {% endcomment %}
                                
                             <form action="{% url 'add_cart' cart_item.product.id %}" method="POST">
                                {% csrf_token %}
                                {% for item in cart_item.variations.all %}
                                <input type="hidden" name="{{item.variation_category | lower}}" value="{{item.variation_value | capfirst}}">
                                
                                {% endfor %}
                                <button  class="btn btn-light" type="submit" id="button-minus"> <i class="fa fa-plus"></i> </button>
                            </form> 
                            </div>
                            </div> <!-- input-group.// -->
                        </div> <!-- col.// -->
        </td>
        <td> 
            <div class="price-wrap"> 
                <var class="price">â‚¹{{cart_item.sub_total}}</var> 
                <small class="text-muted"> â‚¹{{cart_item.product.price}} each </small> 
            </div> <!-- price-wrap .// -->
        </td>
        <td class="text-right"> 
        <a href="{% url 'remove_cart_item' cart_item.product.id  cart_item.id %}" onclick="return confirm('Are you sure You want to delete this item?')" class="btn btn-danger"> Remove</a>
        </td>
    </tr>
    {% endfor %}
    
    </tbody>
    </table>
    </div> <!-- card.// -->
    
        </aside> <!-- col.// -->
        <aside class="col-lg-3">
    
            <div class="card">
            <div class="card-body">
                <dl class="dlist-align">
                  <dt>Total price:</dt>
                  <dd class="text-right">â‚¹{{total}}</dd>
                </dl>
                <dl class="dlist-align">
                  <dt>Tax:</dt>
                  <dd class="text-right"> â‚¹{{tax}}</dd>
                </dl>
                <dl class="dlist-align">
                  <dt>Grand Total:</dt>
                  <dd id="grand" class="text-right text-dark b"><strong>â‚¹{{grand_total}}</strong></dd>
                </dl>
                <hr>
                <p class="text-center mb-3">
                    <img src="{% static './images/misc/payments.png' %}" height="26">
                </p>
                <a href="{% url 'checkout' %}" class="btn btn-primary btn-block"> Checkout </a>
                <a href="{% url 'store' %}" class="btn btn-light btn-block">Continue Shopping</a>
            </div> <!-- card-body.// -->
            </div> <!-- card.// -->
    
    </aside> <!-- col.// -->
    
    
    </div> <!-- row.// -->
    {% endif %}
    <!-- ============================ COMPONENT 1 END .// ================================= -->
    
    </div> 
    <!-- container .//  -->
    {% comment %} <style>
        .disabled{
            pointer-events: none;
            background: rgba(0, 7, 90, .23);
        }
    </style> {% endcomment %}
    </section>
    {% comment %} <script>
   
        function decreaseQuantity(id,count){
        var sumith = document.getElementById(id)
        var decrement='increment'+id
        var btn = document.getElementById(decrement)
          
          console.log(id)
          if (count==-1){
            $.ajax({
                headers: {
                  "X-CSRFToken": $('[name=csrfmiddlewaretoken]').val()
        
                },
                type : "POST",
                url : "{% url 'decreaseQuantity' %}",
        
                data : {
                  
                  id : id
        
        
                },
                success: function(response){
                  quan = response.q
                  document.getElementById(id).innerHTML=quan
                  if(quan ==1){
                    btn.classList.add('disabled')
                  }
                  else{
                    btn.classList.remove('disabled')
                  }
                }
              })
            
          }
          else{
            $.ajax({
                headers: {
                  "X-CSRFToken": $('[name=csrfmiddlewaretoken]').val()
        
                },
                type : "POST",
                url : "{% url 'increaseQuantity' %}",
        
                data : {
                  
                  id : id
        
        
                },
                success: function(response){
                  quan = response.q
                  
                  document.getElementById(id).innerHTML=quan
                  document.getElementById('grand').innerHTML=response.grand_total
                  console.log(quan)
                }
              })
          }
         
          
          
        }
        
      </script> {% endcomment %}

{% endblock content %}



